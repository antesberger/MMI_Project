<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>A-Frame Video Shader - Basic</title>
  <!-- <script src="js/build.js"></script> -->

  <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
  <!-- <script src="https://rawgit.com/mayognaise/aframe-video-shader/master/dist/aframe-vid-shader.min.js"></script> -->
  <script src="js/aframe-extras.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nunjucks/2.3.0/nunjucks.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>
  <script src="https://rawgit.com/ngokevin/aframe-template-component/master/dist/aframe-template-component.min.js"></script>
  <script src="js/aframe-particle-system-component.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="css/common.css"/>
</head>
<body>
  <a-scene fog="type: linear; color: #000000; far: 30; near: 0" stats>

    <!-- assets -->
    <a-assets>
      <video muted id="video" src="assets/video/360test.mp4" playsinline></video>

      <!-- $("#dog")[0].volume = 0.1 -->
      <audio id="dog" loop="true" src="assets/sounds/dog.mp3"></audio>

      <script id="targetBox" type="text/x-nunjucks-template">
        <a-entity template="src: templates/components/targetBox.template; type: handlebars" data-position="0 2.5 3" data-scale="0.3 0.3 0.3"></a-entity>
      </script>

      <script id="room" type="text/x-nunjucks-template">
        <a-entity template="src: templates/components/sphere.template; type: handlebars"
        data-video="#video"
        ></a-entity>
      </script>
    </a-assets>

    <!-- Kamera -->
    <a-entity position="0 2.5 0">
      <a-entity id="camera" camera look-controls wasd-controls>
        <a-cursor radius-outer="0.03" radius-inner="0.02" position="0 0 -0.5" material="color: cyan; shader: flat" max-distance="2">
          <a-animation begin="cursor-hovering" easing="ease-in" attribute="color" fill="forwards" from="cyan" to="#7ED321" dur="350"></a-animation>
        </a-cursor>
      </a-entity>
    </a-entity>
    
    <!-- light -->
    <a-entity light="color:#BBB;intensity:4;type:ambient;"></a-entity>

    <!--Room Geometry-->
    <!-- <a-entity template="src: #room"></a-entity> -->
    <a-videosphere id="test" src="#video" material="shader: standard;" radius="20"></a-videosphere>

    <!-- play sound: $('#sound')[0].components.sound.playSound() -->
    <a-entity id="sound" sound="src: #dog"></a-entity>

    <!-- computer position 180 degree to camera -->
    <a-entity template="src: #targetBox"></a-entity>
  </a-scene>

  <div class="buttons novr">
    <a href="javascript:togglePlayback()">toggle playback</a>
  </div>

  <script src="js/common.js"></script>
  <script type="text/javascript">

    function togglePlayback () {
      var el = document.getElementById('videoSphere')
      var material = Object.assign({}, el.getAttribute('material'))
      material.pause = !material.pause
      el.setAttribute('material', material)
    }

    AFRAME.registerComponent('hover-listener', {
      init: function () {
        //option 1: get video to run smoothly in pinned version and use extra sound trigger
        //option 2: get videos own sound to work and build everything right into that

        $('#video').on('play', function (e) {
          console.log('test');
        //   //set muted 
        //   //$("video").prop('autoplay', false);
            $("video")[0].muted = false;
        //   //$("video").prop('audioTracks')[0].enabled = false;
        });

        this.el.addEventListener('raycaster-intersected', function(evt) {
          if (this.hoveron !== true) {
            this.emit('hoveron');
            this.hoveron = true;
            $('#sound')[0].components.sound.playSound();
            console.log('on');
          }
        }, true);
        this.el.addEventListener('raycaster-intersected-cleared', function(evt) {
          this.emit('hoveroff');
          this.hoveron = false;
        }, true);
      }
    });
  </script>



</body>
</html>

